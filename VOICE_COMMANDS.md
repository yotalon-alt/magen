# פקודות קוליות - מערכת משובים

מסמך זה מתעד את כל הפקודות הקוליות הזמינות במערכת, מבוססות **זיהוי כוונה (Intent)** ולא משפטים קשיחים.

---

## עקרונות זיהוי

- **זיהוי מבוסס מילות מפתח**: הפקודות מזוהות באמצעות מילות מפתח ולא משפט מדויק
- **התאמה לדף הנוכחי**: פקודות עובדות בהתאם לדף בו המשתמש נמצא
- **חילוץ פרמטרים**: שמות ומידע מחולצים מתוך הפקודה הקולית
- **ללא AI חיצוני**: כל הזיהוי מתבצע מקומית באמצעות regex ו-includes

---

## 📍 פקודות גלובליות (עובדות מכל דף)

| פקודה | דוגמאות | תיאור |
|-------|---------|--------|
| **חזור אחורה** | "חזור אחורה", "חזרה", "אחורה" | חוזר למסך הקודם |
| **לך לדף הבית** | "דף הבית", "בית", "לבית" | מעבר לדף הבית |
| **תראה לי את כל המשובים** | "משובים", "תראה משובים", "כל המשובים" | מעבר לדף המשובים |
| **פתח סטטיסטיקה** | "סטטיסטיקה", "סטטיסטיקות", "נתונים" | מעבר לדף הסטטיסטיקה |
| **חפש** | "חפש", "חיפוש" | הודעה על זמינות חיפוש |

---

## 📋 דף תרגילים (Exercises)

| פקודה | דוגמאות | פעולה |
|-------|---------|--------|
| **פתח מעגל פתוח** | "מעגל פתוח", "פתח מעגל" | פותח טופס משוב למעגל פתוח |
| **פתח מעגל פרוץ** | "מעגל פרוץ", "פרוץ" | פותח טופס משוב למעגל פרוץ |
| **פתח סריקות** | "סריקות", "סריקת רחוב" | פותח טופס משוב לסריקות רחוב |
| **פתח מיונים מדריכים** | "מיונים", "מדריכים" | פותח טופס מיונים לקורס מדריכים |

---

## 📝 דף משובים (Feedbacks)

### ניווט וחיפוש

| פקודה | דוגמאות | פעולה |
|-------|---------|--------|
| **כנס למשוב** | "כנס למשוב", "פתח משוב", "כנס לפידבק" | פותח משוב (כללי) |
| **כנס למשוב הראשון** | "משוב ראשון", "ראשון", "למשוב הראשון" | פותח את המשוב הקדום ביותר |
| **כנס למשוב האחרון** | "משוב אחרון", "אחרון", "למשוב האחרון" | פותח את המשוב האחרון |
| **חפש משוב של [שם]** | "חפש משוב של יוסי", "תראה משוב של דני" | מחפש משוב לפי שם נבדק |
| **סגור משוב** | "סגור משוב", "סגור", "חזור מהמשוב" | סוגר משוב פתוח |

### סינון

| פקודה | דוגמאות | פעולה |
|-------|---------|--------|
| **סנן מעגל פתוח** | "סנן מעגל פתוח", "הצג מעגל פתוח" | מסנן משובי מעגל פתוח |
| **סנן מעגל פרוץ** | "סנן מעגל פרוץ", "הצג פרוץ" | מסנן משובי מעגל פרוץ |
| **סנן סריקות** | "סנן סריקות", "הצג סריקות" | מסנן משובי סריקות רחוב |
| **סנן מיונים** | "סנן מיונים", "מיונים מדריכים" | מסנן מיונים לקורס מדריכים |

---

## 📊 דף סטטיסטיקה (Statistics)

### חישובים

| פקודה | דוגמאות | פעולה |
|-------|---------|--------|
| **כמה משובים יש** | "כמה משובים", "סך משובים", "סך כל" | מציג סך כל המשובים |
| **כמה משובים יש לקורס מדריכים** | "כמה משובים מדריכים", "משובי קורס" | מציג משובי קורס מדריכים |
| **כמה משובים יש בתרגיל הזה** | "כמה משובים בתרגיל", "משובים בתקריאה" | מציג משובים לתרגיל הנוכחי (דורש סינון מראש) |

### סינונים

| פקודה | דוגמאות | פעולה |
|-------|---------|--------|
| **אפס סינונים** | "אפס", "נקה סינון", "כל הנתונים" | מאפס את כל הסינונים |
| **סנן לפי קורס מדריכים** | "סנן לפי קורס", "קורס מדריכים", "מיונים מדריכים" | מסנן לפי קורס מדריכים |
| **סנן לפי תרגיל** | "סנן לפי תרגיל", "סנן לפי תקריאה" | מבקש שם תרגיל ספציפי |
| **סנן לפי תאריך** | "סנן לפי תאריך", "תאריך", "תקופה" | מראה הודעה ללחיצה על כפתורי תאריך |
| **סנן לפי יישוב** | "סנן לפי יישוב [שם]", "יישוב [שם]" | מסנן לפי יישוב (חילוץ שם מהפקודה) |

### סינונים מפורטים (תיקיות)

| פקודה | דוגמאות | תיקייה |
|-------|---------|---------|
| **סנן תיקיית מטווחים** | "תיקיית מטווחים", "מטווחי ירי" | מטווחי ירי |
| **סנן תיקיית חטיבה** | "תיקיית חטיבה", "מחלקות ההגנה" | מחלקות ההגנה – חטיבה 474 |
| **סנן תיקיית עבודה במבנה** | "תיקיית במבנה", "עבודה בבניין" | עבודה במבנה |
| **סנן תיקיית מיונים מדריכים** | "תיקיית מיונים מדריכים", "מיונים קורס" | מיונים לקורס מדריכים |
| **סנן תיקיית מיונים כללי** | "תיקיית מיונים", "מיונים כללי" | מיונים – כללי |
| **סנן תיקיית כללי** | "תיקיית משובים", "משובים כללי" | משובים – כללי |

---

## 📚 דף חומר עיוני (Materials)

| פקודה | דוגמאות | פעולה |
|-------|---------|--------|
| **פתח מעגל פתוח** | "פתח מעגל פתוח", "הצג מעגל פתוח" | פותח חומר עיוני מעגל פתוח |
| **פתח מעגל פרוץ** | "פתח פרוץ", "הצג מעגל פרוץ" | פותח חומר עיוני מעגל פרוץ |
| **פתח סריקות** | "פתח סריקות", "הצג סריקות" | פותח חומר עיוני סריקות רחוב |
| **פתח עקרונות לחימה** | "עקרונות", "עקרונות לחימה", "שבע עקרונות" | פותח שבע עקרונות לחימה |
| **פתח סעב"ל** | "סעבל", "עדיפויות", "סדר עדיפויות" | פותח סעב"ל |

---

## 🧠 דוגמאות לשימוש

### תרחיש 1: חיפוש משוב לפי שם
```
משתמש: "חפש משוב של דני"
מערכת: מחפשת את כל המשובים שמכילים "דני"
- אם נמצא משוב אחד → פותחת אותו ישירות
- אם נמצאו מספר משובים → מציגה הודעה "נמצאו X משובים עבור דני"
- אם לא נמצאו → מציגה "לא נמצאו משובים עבור דני"
```

### תרחיש 2: ספירת משובים
```
משתמש: "כמה משובים יש"
מערכת: עוברת לדף סטטיסטיקה ומציגה "סך הכל: 47 משובים"

משתמש: "כמה משובים יש לקורס מדריכים"
מערכת: מציגה "משובי קורס מדריכים: 12"
```

### תרחיש 3: ניווט מהיר
```
משתמש: "לך לדף הבית"
מערכת: עוברת לדף הבית (page index 0)

משתמש: "תראה לי את כל המשובים"
מערכת: עוברת לדף המשובים (page index 2)

משתמש: "חזור אחורה"
מערכת: מבצעת Navigator.pop()
```

### תרחיש 4: איפוס סינונים
```
משתמש: "אפס סינונים"
מערכת: 
1. עוברת לדף סטטיסטיקה
2. מאפסת את כל השדות:
   - תפקיד → "כל התפקידים"
   - מדריך → "כל המדריכים"
   - תרגיל → "כל התרגילים"
   - יישוב → "כל היישובים"
   - תיקייה → "כל התיקיות"
   - שם נבדק → ""
   - תאריך מ/עד → null
3. מציגה "כל הסינונים אופסו"
```

---

## 🔧 טכניקות זיהוי

### 1. זיהוי Intent מבוסס מילות מפתח
```dart
if (_matchIntent(command, ['חזור', 'אחורה', 'חזרה'])) {
  // פעולה: חזרה אחורה
}
```

### 2. חילוץ פרמטרים דינמיים
```dart
// דוגמה: "חפש משוב של יוסי"
final name = _extractParameter(command, ['של ', 'משוב ']);
// name = "יוסי"
```

### 3. זיהוי משולב (AND)
```dart
// דוגמה: "כמה משובים יש לקורס מדריכים"
if (_matchIntent(command, ['כמה משובים']) && 
    _matchIntent(command, ['מדריכים', 'קורס'])) {
  // פעולה: ספירת משובי קורס מדריכים
}
```

---

## 🎯 הערות חשובות

1. **הפקודות לא דורשות משפט מדויק** - מספיק שמילת המפתח תופיע בפקודה
2. **סדר המילים לא משנה** - "משוב של דני" ו-"דני משוב" שניהם יזוהו
3. **ניתן לשלב פקודות** - למשל "סנן מעגל פתוח" יבצע גם סינון וגם מעבר לדף
4. **פקודות גלובליות עדיפות** - נבדקות לפני פקודות ספציפיות לדף
5. **הודעות משוב ויזואליות** - כל פקודה מציגה SnackBar עם תיאור הפעולה

---

## 🐛 דיבוג

לצפייה בלוגים של זיהוי פקודות, פתח את Chrome DevTools (F12) → Console:

```
🎯 Handling command: "חפש משוב של דני" on page 2
📝 Processing feedbacks command: "חפש משוב של דני"
✅ Intent: Search feedback for: דני
📡 Navigating to feedback details...
```

---

## 📝 תיעוד קוד

### קבצים רלוונטיים

- **voice_assistant.dart** (419 שורות)
  - `VoiceAssistantButton` - Widget לכפתור המיקרופון
  - `VoiceCommandHandler.handleCommand()` - Dispatcher ראשי
  - `_matchIntent()` - פונקציית עזר לזיהוי Intent
  - `_extractParameter()` - פונקציית עזר לחילוץ פרמטרים

- **main.dart** (3900+ שורות)
  - `_handleVoiceCommand()` - נקודת כניסה מ-MainScreen
  - `_handleNavigateBack()` - פקודות ניווט גלובליות
  - `_handleNavigateToPage()` - מעבר בין דפים
  - `_handleFeedbackFilter()` - טיפול בפקודות משובים
  - `_handleStatisticsFilter()` - טיפול בפקודות סטטיסטיקה
  - `_handleExerciseAction()` - טיפול בפקודות תרגילים
  - `_handleMaterialsAction()` - טיפול בפקודות חומר עיוני

---

## ✅ מה עובד כרגע

- ✅ פקודות גלובליות (חזור, דף הבית, סטטיסטיקה, משובים)
- ✅ חיפוש משוב לפי שם
- ✅ פתיחת משוב ראשון/אחרון
- ✅ ספירת משובים (כללי, קורס מדריכים, תרגיל נוכחי)
- ✅ איפוס סינונים
- ✅ סינון לפי תיקיות
- ✅ סינון לפי תרגילים
- ✅ סינון לפי יישוב (חילוץ שם מהפקודה)
- ✅ ניווט לתרגילים וחומר עיוני

---

## 🚀 להרחבה עתידית

### פקודות מילוי טופס (טעונות מימוש בעתיד)

כרגע לא מיושמות - דורשות אינטגרציה עם TextField בטופס המשוב:

- "תמלא הערה"
- "תכתוב הערה: [טקסט חופשי]"
- "תוסיף משוב: [טקסט חופשי]"
- "נקה שדה"
- "שמור משוב"

למימוש: דרוש GlobalKey ל-FeedbackFormPage + פונקציות _handleFormFill.

---

**גרסה:** 2.0  
**עדכון אחרון:** דצמבר 2025  
**מחבר:** GitHub Copilot  
