<!DOCTYPE html>
<html>
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="A new Flutter project.">

  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="flutter_application_1">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>××©×•×‘ ××‘×¦×¨</title>
  <link rel="manifest" href="manifest.json">
  
  <script>
    // ×‘×“×™×§×ª ×ª××™×›×” ×‘-Web Speech API
    console.log('ğŸ” Checking Web Speech API support...');
    
    if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
      console.error('âŒ Web Speech API not supported in this browser');
      console.log('ğŸ’¡ Please use Chrome, Edge, or Safari');
    } else {
      console.log('âœ… Web Speech API is supported');
    }
    
    // ×‘×“×™×§×ª ×”×¨×©××•×ª ××™×§×¨×•×¤×•×Ÿ
    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
      console.log('âœ… getUserMedia API available');
    } else {
      console.error('âŒ getUserMedia API not available');
      console.log('ğŸ’¡ Make sure you are using HTTPS or localhost');
    }
    
    // ×‘×“×™×§×ª ×¤×¨×•×˜×•×§×•×œ
    if (window.location.protocol === 'https:' || window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
      console.log('âœ… Running on secure context (HTTPS/localhost)');
    } else {
      console.warn('âš ï¸ Not running on secure context - microphone may not work');
      console.log('ğŸ’¡ Use HTTPS or localhost for microphone access');
    }
  </script>
</head>
<body>
  <script>
    let recognition = null;
    let currentCallback = null;
    let currentErrorCallback = null;

    window.startWebSpeechRecognition = function(callback, errorCallback) {
      console.log('ğŸ¤ startWebSpeechRecognition called');
      currentCallback = callback;
      currentErrorCallback = errorCallback;

      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      
      if (!SpeechRecognition) {
        console.error('âŒ Speech Recognition not supported');
        if (errorCallback) errorCallback('Speech Recognition not supported');
        return;
      }

      try {
        recognition = new SpeechRecognition();
        recognition.lang = 'he-IL';
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;

        recognition.onstart = function() {
          console.log('ğŸ¤ Speech recognition started');
        };

        recognition.onresult = function(event) {
          const transcript = event.results[0][0].transcript;
          console.log('ğŸ“ Recognized:', transcript);
          if (callback) callback(transcript);
        };

        recognition.onerror = function(event) {
          console.error('âŒ Speech recognition error:', event.error);
          if (event.error === 'not-allowed') {
            if (errorCallback) errorCallback('Microphone permission denied');
          } else if (event.error === 'no-speech') {
            if (errorCallback) errorCallback('No speech detected');
          } else {
            if (errorCallback) errorCallback(event.error);
          }
        };

        recognition.onend = function() {
          console.log('ğŸ”´ Speech recognition ended');
          recognition = null;
        };

        recognition.start();
        console.log('âœ… Recognition started successfully');
      } catch (error) {
        console.error('âŒ Failed to start recognition:', error);
        if (errorCallback) errorCallback(error.message);
      }
    };

    window.stopWebSpeechRecognition = function() {
      console.log('ğŸ›‘ stopWebSpeechRecognition called');
      if (recognition) {
        try {
          recognition.stop();
          recognition = null;
        } catch (error) {
          console.error('âŒ Error stopping recognition:', error);
        }
      }
    };
  </script>
  <script src="flutter_bootstrap.js" async></script>
</body>
</html>
