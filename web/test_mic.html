<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×‘×“×™×§×ª ××™×§×¨×•×¤×•×Ÿ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-box {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        #status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            font-size: 16px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        #recognized {
            margin-top: 20px;
            padding: 15px;
            background: #e7f3ff;
            border-radius: 5px;
            min-height: 50px;
            font-size: 18px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="test-box">
        <h1>ğŸ¤ ×‘×“×™×§×ª ××™×§×¨×•×¤×•×Ÿ ×•×“×™×‘×•×¨</h1>
        
        <div>
            <button onclick="testMicrophone()">1ï¸âƒ£ ×‘×“×•×§ ×’×™×©×” ×œ××™×§×¨×•×¤×•×Ÿ</button>
            <button onclick="testSpeechRecognition()">2ï¸âƒ£ ×‘×“×•×§ ×–×™×”×•×™ ×§×•×œ×™</button>
            <button onclick="startListening()" id="listenBtn">ğŸ¤ ×”×ª×—×œ ×”××–× ×” (×¢×‘×¨×™×ª)</button>
        </div>
        
        <div id="status"></div>
        <div id="recognized"></div>
    </div>

    <script>
        let recognition = null;
        
        function log(message, type = 'info') {
            console.log(message);
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = message;
            statusDiv.className = type;
        }

        function testMicrophone() {
            log('ğŸ” ×‘×•×“×§ ×”×¨×©××•×ª ××™×§×¨×•×¤×•×Ÿ...', 'info');
            
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                log('âŒ getUserMedia ×œ× ×–××™×Ÿ ×‘×“×¤×“×¤×Ÿ ×–×”. × ×“×¨×© Chrome/Edge/Safari', 'error');
                return;
            }
            
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    log('âœ… ×’×™×©×” ×œ××™×§×¨×•×¤×•×Ÿ ×”×•×¢× ×§×” ×‘×”×¦×œ×—×”!', 'success');
                    console.log('Stream:', stream);
                    stream.getTracks().forEach(track => track.stop());
                })
                .catch(error => {
                    log(`âŒ ×©×’×™××” ×‘×’×™×©×” ×œ××™×§×¨×•×¤×•×Ÿ: ${error.name} - ${error.message}<br>
                         ğŸ’¡ ×•×•×“× ×©××™×©×¨×ª ×’×™×©×” ×œ××™×§×¨×•×¤×•×Ÿ ×‘×“×¤×“×¤×Ÿ`, 'error');
                    console.error('Microphone error:', error);
                });
        }

        function testSpeechRecognition() {
            log('ğŸ” ×‘×•×“×§ ×ª××™×›×” ×‘-Web Speech API...', 'info');
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            
            if (!SpeechRecognition) {
                log('âŒ Web Speech API ×œ× × ×ª××š ×‘×“×¤×“×¤×Ÿ ×–×”. × ×“×¨×© Chrome/Edge', 'error');
                return;
            }
            
            log('âœ… Web Speech API × ×ª××š! ××¤×©×¨ ×œ×”×©×ª××© ×‘×–×™×”×•×™ ×§×•×œ×™', 'success');
        }

        function startListening() {
            console.log('ğŸ¤ mic button clicked');
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            
            if (!SpeechRecognition) {
                log('âŒ Web Speech API ×œ× × ×ª××š', 'error');
                return;
            }
            
            if (recognition) {
                recognition.stop();
                recognition = null;
                document.getElementById('listenBtn').textContent = 'ğŸ¤ ×”×ª×—×œ ×”××–× ×” (×¢×‘×¨×™×ª)';
                return;
            }
            
            console.log('ğŸ” microphone permission requested');
            
            recognition = new SpeechRecognition();
            recognition.lang = 'he-IL';
            recognition.continuous = false;
            recognition.interimResults = true;
            
            recognition.onstart = () => {
                console.log('âœ… microphone permission granted');
                console.log('ğŸ¤ speech recognition started');
                log('ğŸ¤ ×××–×™×Ÿ... ×“×‘×¨ ×¢×›×©×™×• ×‘×¢×‘×¨×™×ª', 'success');
                document.getElementById('listenBtn').textContent = 'â¹ï¸ ×¢×¦×•×¨ ×”××–× ×”';
            };
            
            recognition.onresult = (event) => {
                let transcript = '';
                for (let i = 0; i < event.results.length; i++) {
                    transcript += event.results[i][0].transcript;
                }
                console.log('ğŸ“ Recognized:', transcript);
                document.getElementById('recognized').innerHTML = `<strong>×–×™×”×™×ª×™:</strong> ${transcript}`;
            };
            
            recognition.onerror = (event) => {
                console.error('âŒ Speech recognition error:', event.error);
                log(`âŒ ×©×’×™××”: ${event.error}<br>
                     ${event.error === 'not-allowed' ? 'ğŸ’¡ × × ×œ××©×¨ ×’×™×©×” ×œ××™×§×¨×•×¤×•×Ÿ' : ''}
                     ${event.error === 'no-speech' ? 'ğŸ’¡ ×œ× ×–×•×”×” ×“×™×‘×•×¨ - × ×¡×” ×©×•×‘' : ''}`, 'error');
                recognition = null;
                document.getElementById('listenBtn').textContent = 'ğŸ¤ ×”×ª×—×œ ×”××–× ×” (×¢×‘×¨×™×ª)';
            };
            
            recognition.onend = () => {
                console.log('ğŸ”´ speech recognition ended');
                recognition = null;
                document.getElementById('listenBtn').textContent = 'ğŸ¤ ×”×ª×—×œ ×”××–× ×” (×¢×‘×¨×™×ª)';
            };
            
            try {
                recognition.start();
            } catch (error) {
                console.error('âŒ Failed to start recognition:', error);
                log(`âŒ ×©×’×™××” ×‘×”×¤×¢×œ×ª ×–×™×”×•×™ ×§×•×œ×™: ${error.message}`, 'error');
            }
        }
        
        // ×‘×“×™×§×” ××•×˜×•××˜×™×ª ×‘×˜×¢×™× ×ª ×”×“×£
        window.onload = () => {
            console.log('ğŸ” Checking browser support...');
            console.log('Protocol:', window.location.protocol);
            console.log('Hostname:', window.location.hostname);
            
            if (window.location.protocol !== 'https:' && 
                window.location.hostname !== 'localhost' && 
                window.location.hostname !== '127.0.0.1') {
                log('âš ï¸ ××–×”×¨×”: ×œ× ×¨×¥ ×¢×œ HTTPS - ×”××™×§×¨×•×¤×•×Ÿ ×¢×©×•×™ ×œ× ×œ×¢×‘×•×“', 'error');
            }
        };
    </script>
</body>
</html>
