# תרגילי הפתעה - תיעוד מערכת העקרונות

## סיכום השינויים

### 1. רשימת עקרונות קבועה (8 עקרונות)

המערכת עברה משימוש ב"מקצים" לשימוש ב"עקרונות" בתרגילי הפתעה.

**רשימת העקרונות הסופית:**

1. **קשר עין**
2. **בחירת ציר התקדמות**
3. **איום עיקרי ואיום משני**
4. **קצב אש ומרחק**
5. **ירי בטוח בתוך קהל**
6. **וידוא ניטרול**
7. **זיהוי והדחה**
8. **רמת ביצוע**

### 2. ממשק משתמש (UI)

#### התנהגות זהה למטווחי ירי:
- ✅ אותם גופנים
- ✅ אותם מרווחים
- ✅ אותה מבנה
- ✅ אותה התנהגות כפתורים

#### שינויי טקסט בלבד:
- "הוסף מקצה" → **"הוסף עיקרון"**
- "מקצה" → **"עיקרון"**
- "מקצים" → **"עקרונות"**

#### תהליך הוספת עיקרון:
1. לחיצה על **"הוסף עיקרון"**
2. dropdown מציג 8 עקרונות קבועים בלבד (ללא טקסט חופשי)
3. עיקרון נבחר מתווסף כבלוק
4. תחת כל עיקרון:
   - **שדה ציון בלבד** (1-10)
   - **ללא** שדה כדורים
   - **ללא** שדות נוספים

### 3. חישובים וסיכומים

#### ציונים לעיקרון:
- **טווח:** 1-10 (מספרים שלמים בלבד)
- **אחסון:** כל עיקרון שומר את הציון שלו

#### סיכום בצד שמאל:
- **ממוצע עקרונות:** סכום כל ציוני העקרונות / מספר העקרונות שנוספו
- **סך הכול:** סכום כל הציונים

#### נוסחה:
```
ממוצע = (ציון עיקרון 1 + ציון עיקרון 2 + ... + ציון עיקרון N) / N
סך הכול = ציון עיקרון 1 + ציון עיקרון 2 + ... + ציון עיקרון N
```

### 4. רשימת חניכים

#### מבנה הטבלה (RTL):
```
┌─────────┬──────────┬────────────┬────────────┬─────────┐
│  מספר   │   שם     │  עיקרון 1 │  עיקרון 2 │  סה"כ   │
│ (ימין) │ (אמצע)  │  (שמאל)   │  (שמאל)   │ (שמאל) │
└─────────┴──────────┴────────────┴────────────┴─────────┘
```

**עמודת מספר:** ✅ **נמצאת בצד ימין** של שם החניך (תאימות RTL)

### 5. מודל נתונים

#### סוג המסמך:
```json
{
  "exercise": "תרגילי הפתעה",
  "folder": "משוב תרגילי הפתעה",
  "rangeType": "הפתעה",
  "mode": "surprise"
}
```

#### מבנה עקרונות:
```json
{
  "stations": [
    {
      "name": "קשר עין",
      "bulletsCount": 0,
      "timeSeconds": null,
      "hits": null,
      "isManual": false,
      "isLevelTester": false,
      "selectedRubrics": []
    },
    {
      "name": "בחירת ציר התקדמות",
      "bulletsCount": 0,
      ...
    }
  ]
}
```

#### מבנה חניכים:
```json
{
  "trainees": [
    {
      "name": "שם החניך",
      "number": 1,
      "hits": {
        "station_0": 8,  // ציון עיקרון 1: 8/10
        "station_1": 7,  // ציון עיקרון 2: 7/10
        "station_2": 9   // ציון עיקרון 3: 9/10
      },
      "totalHits": 24
    }
  ]
}
```

**הערה:** שדה `hits` משמש גם לציונים (1-10) בתרגילי הפתעה, לא רק לפגיעות במטווחים.

### 6. ייצוא Excel

#### שם קובץ:
```
משוב תרגילי הפתעה - YYYY-MM-DD.xlsx
```

#### שם גיליון:
```
משוב תרגילי הפתעה
```

#### מבנה עמודות:
| פיקוד | חטיבה | שם המדריך | תאריך | קשר עין | בחירת ציר | איום עיקרי | קצב אש | ירי בטוח | וידוא | זיהוי | רמת ביצוע | סך הכול | ממוצע |
|-------|-------|-----------|-------|---------|----------|-----------|--------|----------|-------|------|-----------|---------|-------|
| ...   | ...   | ...       | ...   | 8       | 7        | 9         | 6      | 8        | 7     | 9    | 8         | 62      | 7.75  |

#### דגשים:
- ✅ Hebrew headers (עברית)
- ✅ RTL mode (`sheet.isRTL = true`)
- ✅ 8 עמודות עקרונות קבועות (בסדר)
- ✅ סך הכול וממוצע בצד שמאל

### 7. תקינות (Validation)

#### לפני שמירה:
- ❌ **אסור לשמור** ללא עיקרון אחד לפחות
- ❌ **אסור ציונים** מחוץ לטווח 1-10
- ✅ **ציון 0** אסור (חייב 1-10)

#### הודעות שגיאה:
```dart
'ציון חייב להיות בין 1 ל-10'
'אנא הזן שם לעיקרון'
'אנא בחר יישוב/מחלקה'
```

### 8. אי-השפעה על מערכות אחרות

#### ✅ **לא הושפעו:**
- טווח קצר (`rangeType: 'קצרים'`, `mode: 'range'`)
- טווח רחוק (`rangeType: 'ארוכים'`, `mode: 'range'`)
- מיונים לקורס מדריכים
- מיונים כללי
- כל המשובים הרגילים

#### 🔒 **הפרדה:**
```dart
// Range mode uses stations with bullets
if (widget.mode == 'range') {
  // Display bullets field
  // Validate hits <= bulletsCount
}

// Surprise mode uses principles with 1-10 scores
else if (widget.mode == 'surprise') {
  // Hide bullets field
  // Validate scores 1-10
}
```

---

## קבצים שונו

### 1. `lib/range_training_page.dart`
**שורות 46-55:** עדכון רשימת העקרונות

**לפני:**
```dart
'איום עיקרי ואיום משני',
'ירי בטוח וקרוב',
'זיהוי והדרכות',
```

**אחרי:**
```dart
'איום עיקרי ואיום משני',    // הוסר "זיהוי"
'ירי בטוח בתוך קהל',         // שונה מ"וקרוב"
'זיהוי והדחה',                // שונה מ"והדרכות"
```

### 2. `lib/feedback_export_service.dart`
**שורות 2019-2028:** עדכון רשימת העקרונות בייצוא

**תיקונים זהים** כמו ב-`range_training_page.dart` לתאימות מלאה.

---

## בדיקות מומלצות

### ✅ Checklist:
1. [ ] פתח **תרגילים → תרגילי הפתעה**
2. [ ] לחץ **הוסף עיקרון** - ודא dropdown מציג 8 עקרונות בלבד
3. [ ] בחר **קשר עין** - ודא הבלוק מופיע ללא שדה כדורים
4. [ ] הזן **ציון 8** - ודא מקבל (1-10)
5. [ ] נסה **ציון 11** - ודא מקבל שגיאה
6. [ ] הוסף **3 עקרונות נוספים**
7. [ ] הזן **5 חניכים** עם ציונים
8. [ ] ודא **עמודת מספר** מימין לשם
9. [ ] ודא **סיכום** מראה ממוצע וסך הכול נכון
10. [ ] שמור משוב - ודא נשמר ב-**משוב תרגילי הפתעה**
11. [ ] ייצא ל-Excel - ודא 8 עמודות עקרונות + סך + ממוצע

---

## נתוני דוגמה

### משוב לדוגמה:
```json
{
  "exercise": "תרגילי הפתעה",
  "folder": "משוב תרגילי הפתעה",
  "rangeType": "הפתעה",
  "settlement": "קצרין",
  "attendeesCount": 5,
  "instructorName": "רס״פ כהן",
  "stations": [
    {"name": "קשר עין", "bulletsCount": 0},
    {"name": "בחירת ציר התקדמות", "bulletsCount": 0},
    {"name": "איום עיקרי ואיום משני", "bulletsCount": 0}
  ],
  "trainees": [
    {
      "name": "חייל א",
      "number": 1,
      "hits": {"station_0": 8, "station_1": 7, "station_2": 9},
      "totalHits": 24
    },
    {
      "name": "חייל ב",
      "number": 2,
      "hits": {"station_0": 9, "station_1": 8, "station_2": 8},
      "totalHits": 25
    }
  ]
}
```

### חישוב ממוצע:
```
חייל א:
  עקרונות: 3
  סך הכול: 8 + 7 + 9 = 24
  ממוצע: 24 / 3 = 8.0

חייל ב:
  עקרונות: 3
  סך הכול: 9 + 8 + 8 = 25
  ממוצע: 25 / 3 = 8.33
```

---

## סיכום טכני

| היבט | טווח קצר/רחוק | תרגילי הפתעה |
|------|----------------|--------------|
| **מצב** | `mode: 'range'` | `mode: 'surprise'` |
| **פריטים** | 14 מקצים | 8 עקרונות |
| **dropdown** | מקצים + מקצה ידני | עקרונות בלבד |
| **שדה כדורים** | ✅ חובה | ❌ מוסתר |
| **ציונים** | 0 עד bulletsCount | 1-10 |
| **בוחן רמה** | ✅ נתמך | ❌ לא נתמך |
| **תיקייה** | 'מטווחי ירי' | 'משוב תרגילי הפתעה' |
| **ייצוא** | דיווח קצר/רחוק | משוב תרגילי הפתעה |

---

**תאריך עדכון:** {{ current_date }}
**גרסה:** 2.0
**מפתח:** AI Assistant (GitHub Copilot)
